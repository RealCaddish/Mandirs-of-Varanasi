<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Mandirs of Uttar Pradesh</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f8f9fa;
      font-family: 'Roboto', sans-serif;
      font-size: 16px;
      font-weight: 400;
      color: #333;
      line-height: 1.6;
    }

         header {
       background: #FF9933;
       color: white;
       padding: 40px 20px;
       text-align: center;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
     }

    h1 {
      font-family: 'Roboto', sans-serif;
      font-size: 3.5em;
      font-weight: 700;
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    h2 {
      font-family: 'Roboto', sans-serif;
      font-size: 1.5em;
      font-weight: 300;
      margin: 0;
      opacity: 0.9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Dashboard Styles */
    .stats-container {
      display: flex;
      justify-content: space-around;
      margin: 20px auto;
      gap: 20px;
      flex-wrap: wrap;
    }
    
         .stat-box {
       background: #138808;
       color: white;
       padding: 25px;
       border-radius: 15px;
       text-align: center;
       box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
       flex: 1;
       min-width: 150px;
       transition: transform 0.3s ease;
     }
    
    .stat-box:hover {
      transform: translateY(-5px);
    }
    
    .stat-number {
      display: block;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .stat-label {
      font-size: 1em;
      opacity: 0.9;
      font-weight: 400;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 30px auto;
      flex-wrap: wrap;
    }
    
    .control-btn {
      background: white;
      border: 2px solid #e9ecef;
      padding: 12px 24px;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-family: 'Roboto', sans-serif;
      color: #495057;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
         .control-btn:hover {
       background: #f8f9fa;
       border-color: #FF9933;
       transform: translateY(-2px);
       box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
     }
    
         .control-btn.active {
       background: #138808;
       color: white;
       border-color: #138808;
     }

    /* Article Toggle Button */
         .article-toggle {
       background: #138808;
       color: white;
       border: none;
       padding: 15px 30px;
       border-radius: 30px;
       cursor: pointer;
       font-family: 'Roboto', sans-serif;
       font-weight: 500;
       font-size: 1.1em;
       margin: 20px auto;
       display: block;
       transition: all 0.3s ease;
       box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
     }

    .article-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    }

    /* Article Section */
    .article-section {
      background: white;
      border-radius: 20px;
      padding: 0;
      margin: 30px auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.5s ease;
    }

         .article-section.expanded {
       max-height: 4000px;
     }

    .article-content {
      padding: 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: start;
    }

    .article-text {
      font-family: 'Roboto', sans-serif;
      font-size: 1.1em;
      line-height: 1.8;
      color: #495057;
    }

    .article-text p {
      margin-bottom: 20px;
      text-align: justify;
    }

         .article-text a {
       color: #FF9933;
       text-decoration: none;
       font-weight: 500;
       border-bottom: 2px solid transparent;
       transition: border-color 0.3s ease;
     }

     .article-text a:hover {
       border-bottom-color: #FF9933;
     }

    .article-images {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .article-image {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }

    .article-image:hover {
      transform: scale(1.02);
    }

         .article-image img {
       width: 100%;
       height: auto;
       max-height: 400px;
       object-fit: contain;
       display: block;
     }

    .image-caption {
      background: #f8f9fa;
      padding: 15px;
      font-family: 'Roboto', sans-serif;
      font-size: 0.9em;
      color: #6c757d;
      font-style: italic;
      text-align: center;
    }

         .image-caption a {
       color: #FF9933;
       text-decoration: none;
       font-weight: 500;
     }

         .quote-box {
       background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
       border-left: 4px solid #FF9933;
       padding: 25px;
       margin: 30px 0;
       border-radius: 10px;
       font-style: italic;
       font-size: 1.1em;
       color: #495057;
     }

    #map {
      width: 100%;
      height: 800px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin: 30px 0;
    }
    
    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin: 40px auto;
    }
    
    .chart-container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .chart-container:hover {
      transform: translateY(-5px);
    }
    
    .chart-title {
      font-size: 1.3em;
      font-weight: 600;
      margin-bottom: 20px;
      color: #333;
      text-align: center;
      font-family: 'Roboto', sans-serif;
    }
    
    /* Legend styles */
    .legend {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      font-family: 'Roboto', sans-serif;
    }
    
    .legend h4 {
      margin: 0 0 15px 0;
      font-size: 1em;
      font-weight: 600;
      color: #333;
    }
    
    .legend i {
      width: 20px;
      height: 20px;
      float: left;
      margin-right: 10px;
      opacity: 0.8;
      border-radius: 3px;
    }

    .legend br {
      clear: both;
      margin-bottom: 8px;
    }

    footer {
      background: #343a40;
      color: white;
      text-align: center;
      padding: 30px;
      margin-top: 50px;
      font-family: 'Roboto', sans-serif;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .article-content {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 20px;
      }

      .stats-container {
        flex-direction: column;
      }

      .controls {
        flex-direction: column;
        align-items: center;
      }

      .charts-section {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 2.5em;
      }

      .container {
        padding: 10px;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1></h1>
    <h2></h2>
  </header>

  <div class="container">
    <!-- Dashboard Statistics -->
    <div class="stats-container">
      <div class="stat-box">
        <span class="stat-number" id="total-mandirs">-</span>
        <div class="stat-label">Total Mandirs</div>
      </div>
      <div class="stat-box">
        <span class="stat-number" id="max-density">-</span>
        <div class="stat-label">Highest Density</div>
      </div>
      <div class="stat-box">
        <span class="stat-number" id="avg-density">-</span>
        <div class="stat-label">Average Density</div>
      </div>
      <div class="stat-box">
        <span class="stat-number" id="coverage-area">-</span>
        <div class="stat-label">Coverage (km²)</div>
      </div>
    </div>

    <!-- Article Toggle Button -->
    <button class="article-toggle" onclick="toggleArticle()">
      📖 Read About the Mandirs of Varanasi
    </button>

    <!-- Article Section -->
    <div class="article-section" id="articleSection">
      <div class="article-content">
        <div class="article-text">
          <p>In a small alleyway off the Nai Sarak - Luxa intersection, a radiant peach-colored box has attracted two adherents, offering <a href="https://en.wikipedia.org/wiki/Puja_(Hinduism)">puja</a> at the seat of Vishnu's mount. It's a brisk morning here in the City of Light and the sound of motorcycles and automobile horns are beginning to fill the air again. There will be two more adherents who will pass by, receiving their morning blessing before they're off to work as well. Down the street, three gentlemen are closely seated around another one of these drink machine-sized enclosures. At first sight, it seems that they're performing a ritual for Shiva, but on second glance, they're performing a wholly unexpected one, passing a lit <a href="https://en.wikipedia.org/wiki/Chillum_(pipe)">chillum</a> around in equal intervals. When asked, they don't hesitate to tell us that <i>"We smoke ganja here so that we can get Shiva high too."</i> It's an offering that is perhaps a bit unorthodox but also welcomed nonetheless.</p>
          
          <p>These enclosures are known as 'mandirs' in India - little temples that house various deities from the Hindu pantheon, often found next to trees, built into the sides of buildings, or close to water wells. Scholarship associated with the function and study of sacred space in Hinduism has fallen short of providing a comprehensive view of the Hindu religious landscape as it relates to these little temples. Traditionally, the field has put heavy emphasis on grand, monolithic temple spaces as the predominant form of veneration among Hindu adherents. Oftentimes, grand temples such as the Kashi Vishwanath Temple or the Mrityunjay Mahadev Mandir served as examples of Hinduism's primary venerative hotspots. However, the most recurrent and numerous temples are typically no larger than these 1x1x1 meter shelters found throughout the city.</p>

          <p>The diversity of thought, ritual, cosmological systems, and theology shouldn't surprise anyone that temple building and sacred space are also characteristically varied in Hinduism as well. Regardless, a primary function of the temple or mandir, is to house the deity. Within Hinduism, a wide corpus of major and minor traditions exist such as principal deities like Ganesha or Shiva. There are a wide variety of other, lesser known deities too, where many are considered <i>house churches</i> or those gods or goddesses venerated within a family or household.</p>

          <p>Over 3,347 individual mandirs were collected and recorded within the metropolitan area of Varanasi. Interviews and photographs were collected in conjunction with a recorded GPS point for the mandir's location. Additionally, we collected information pertaining to the mandir's association with buildings, wells, trees, or anything that would suggest it's location as sacred space. We also recorded how many deities were present at a mandir as well as recording any associative information we thought would be important to tell their story.</p>

          <p>By mapping out characteristics of mandirs we identified, our hope is that a more readily comprehensive geography of the city's public temples will emerge. Additionally, more analytical questions can be asked regarding frequency of temple localities that our GIS can play a role in answering.</p>
        </div>

        <div class="article-images">
          <div class="article-image">
            <img src="images/kashiTemple.jpg" alt="Kashi Temple">
            <div class="image-caption">
              Above is an image of the <a href="https://en.wikipedia.org/wiki/Shri_Vishwanath_Mandir">Shri Vishwanath Mandir</a> on the campus of Benaras Hindu University in Varanasi. Photograph by Nathaniel Deaton
            </div>
          </div>

          <div class="article-image">
            <img src="images/mandir1.jpg" alt="Tiny Temple">
            <div class="image-caption">
              Above is an image of a small mandir abutting a building to the right with chairs as a frame of reference. Notice the images of deities above the main housing structure; this particular mandir venerates several deities including Ganesh, Shiva, and others. Photograph by Nathaniel Deaton
            </div>
          </div>

          <div class="article-image">
            <img src="images/shiva.jpg" alt="Shiva">
            <div class="image-caption">
              Above is an image of <a href='https://en.wikipedia.org/wiki/Garuda'>Garuda</a>, the vehicle (vahana) of Vishnu. Small mandirs can range from having large deital sculptures to containing no image whatsoever. Photograph by Nathaniel Deaton
            </div>
          </div>

          <div class="article-image">
            <img src="images/gangesDog.JPG" alt="Ganges Dog">
            <div class="image-caption">
              A happy dog after cooling off in the holy Ganges River. Photograph by Nathaniel Deaton
            </div>
          </div>

          <div class="article-image">
            <img src="images/sacredCow.jpg" alt="Sacred Cow">
            <div class="image-caption">
              Cattle out for a stroll through an alleyway in Varanasi. Photograph by Nathaniel Deaton
            </div>
          </div>
        </div>
      </div>

      <div class="article-content" style="grid-template-columns: 1fr; margin-top: 0;">
        <div class="article-text">
          <p>A large majority of the mandirs that we identified were located close to the <a href="https://en.wikipedia.org/wiki/Ghat">ghats</a> along the western bank of the <a href="https://en.wikipedia.org/wiki/Ganges">Ganges River</a> in Varanasi. It's not surprising that this is where many of them reside because of the central role that the holy Ganges plays in the <a href="https://en.wikipedia.org/wiki/Vedas">Sanskrit Vedas.</a> The ghats along the bank are filled with activity. You'll often find people bathing, collecting water, offering oblations to the sacred fires from Vedic traditions such as Yajna, and an entire host of other events such as marriages, funerals at <a href="https://en.wikipedia.org/wiki/Manikarnika_Ghat">Manikarnika Ghat.</a> Haskett's publication on these temples was published in the <i>South Asia Multidisciplinary Academic Journal</i> in 2018 and you can read more about his work <a href="https://journals.openedition.org/samaj/4524">here.</a></p>

          <p>The goal of this project is to build upon the database of temples that were collected in 2012 and 2015 by creating an interactive map that allows viewers to learn more details about the location, deities, and sacred space these mandirs impart on the local community. Below you'll find a map of the mandirs where spatial analysis was performed to find where the density of the mandirs are around the city. Unsurprisingly, the largest clusters were found by the banks of the Ganges and the number begins to wane the further inland you travel.</p>

          <div class="quote-box">
            <strong>Haskett states:</strong><br><br>
            "By observing where temples occur and the other features of landscape with which they frequently coincide, we can learn how temples instantiate the presence of deities at important junctures of shared space... our data also suggests a number of insights about the roles that tiny temples play in making Hinduism for the residents of Varanasi."
          </div>

          <p>We're hoping to continue this research and build a more robust GIS that can also identify affiliated deities as well as provide photographs and other pertinent information. Additionally, many of these mandirs were often found in Muslim neighborhoods so more attention to their role in that religious context is of great interest. Without question, the 'tiny temples' of Varanasi play a major role in the shared sacred experience of the community and deserve more attention in the academy. By examining their role in society, we hope that we can provide a more stable ground to understanding Hinduism in light of their frequent and multifaceted nature.</p>
        </div>
      </div>
    </div>

    <!-- Map Controls -->
    <div class="controls">
      <button class="control-btn active" onclick="switchLayer('density')">🗺️ Density View</button>
      <button class="control-btn" onclick="switchLayer('individual')">🏛️ Individual Mandirs</button>
      <button class="control-btn" onclick="resetView()">🔄 Reset View</button>
    </div>

    <div id='map'></div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <div class="chart-title">Mandir Density Distribution</div>
        <canvas id="densityChart" style="max-height: 300px;"></canvas>
      </div>
      
      <div class="chart-container">
        <div class="chart-title">Deity Distribution</div>
        <canvas id="deityChart" style="max-height: 300px;"></canvas>
      </div>
      
      <div class="chart-container">
        <div class="chart-title">Temple Structure Types</div>
        <canvas id="structureChart" style="max-height: 300px;"></canvas>
      </div>
    </div>

    <div style="text-align: center; margin: 30px 0;">
      <p style="font-size: 1.1em; color: #6c757d;"><strong>Interactive map showing mandir density clusters and individual temple locations. Use the controls above to switch between density view and individual mandir view.</strong></p>
    </div>
  </div>

  <footer>
    <p>Map authored by Nathaniel Deaton</p>
    <p>Interactive Dashboard & Data Visualization</p>
  </footer>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src='https://unpkg.com/simple-statistics@7.6.0/dist/simple-statistics.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    //console.log('this works')
    //console.log(mandirs)
    jQuery("h1").html("The 'Mini Mandirs' of Varanasi");
    jQuery("h2").html("How the 'Tiny Temples' of the City of Light Inform Us About Hindu Shared Experience")

    var options = {
      center: [25.288792, 83.005975],
      zoom: 12.5,
      zoomSnap: 1,
      zoomControl: false
    }

    var map = L.map('map', options); // map variable storing object and options

    var mandirImage = "mandirs-of-Uttar-Pradesh/images/mandir1.jpg"

    var Thunderforest_Outdoors = L.tileLayer(
      'https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={apikey}', {
        attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        apikey: '21ef519d083c43a0b670676d01dbe02f',
        maxZoom: 22
      }).addTo(map);

    map.addControl(L.control.zoom({
      position: 'topright'
    }));

    // mandirData = 'geoJSON/ganges_mandirs.geojson' // Path to mandir geoJSON data


    const deityData = 'geoJSON/data/hex_final.geojson'
    const count = "deity_count"
    var values = [];

    let hexData = [];
    let mandirData = []; // Individual temple data

    $(document).ready(function() {
        updateStatistics(); // Show loading state immediately
        loadData();
        initializeCharts();
    });

    function loadData() {
        // Load hexagonal density data
        $.getJSON(deityData, function (data) {
            hexData = data.features;
            displayHexData();
            updateDensityChart();
        });
        
        // Load individual temple data
        $.getJSON('geoJSON/data/temple/temple.json', function(data) {
            mandirData = data.features;
            console.log('Loaded', mandirData.length, 'individual mandirs');
            updateStatistics(); // Move this here so it runs after mandir data loads
            updateDeityChart();
            updateStructureChart();
        });
    }

    function displayHexData() {
        // Clear existing layers
        if (window.hexLayer) {
            map.removeLayer(window.hexLayer);
        }
        
        window.hexLayer = L.geoJSON(hexData, {
            style: function(feature) {
                const count = feature.properties.deity_count || 0;
                return {
                    fillColor: getColorByCount(count),
                    weight: 2,
                    opacity: 1,
                    color: '#333',
                    fillOpacity: 0.7
                };
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup(`
                    <strong>Hexagon Cluster</strong><br>
                    Mandirs: ${feature.properties.deity_count || 0}<br>
                    <small>Click "Individual Mandirs" to see specific temples</small>
                `);
            }
        }).addTo(map);
        
        addLegend();
    }

    function displayMandirData() {
        // Clear existing layers
        if (window.hexLayer) {
            map.removeLayer(window.hexLayer);
        }
        if (window.mandirLayer) {
            map.removeLayer(window.mandirLayer);
        }
        
        // Create individual mandir markers
        window.mandirLayer = L.geoJSON(mandirData, {
            pointToLayer: function(feature, latlng) {
                const deityCount = feature.properties.deities_pr || 0;
                const size = Math.max(3, Math.min(8, 3 + deityCount * 0.5));
                
                return L.circleMarker(latlng, {
                    radius: size,
                    fillColor: getDeityColor(feature.properties.deity),
                    color: '#333',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
            },
            onEachFeature: function(feature, layer) {
                const props = feature.properties;
                const deities = props.deity || 'Unknown';
                const structure = props.temple_str || 'Unknown';
                const name = props.temple_nam || 'Unnamed';
                const deityCount = props.deities_pr || 0;
                
                layer.bindPopup(`
                    <div style="min-width: 200px;">
                        <strong>${name || 'Mandir'}</strong><br>
                        <strong>Deity:</strong> ${deities}<br>
                        <strong>Structure:</strong> ${structure}<br>
                        <strong>Deities Present:</strong> ${deityCount}<br>
                        <small>Lat: ${props.latitude?.toFixed(6)}<br>
                        Lon: ${props.longitude?.toFixed(6)}</small>
                    </div>
                `);
            }
        }).addTo(map);
        
        addLegend();
    }

    function getDeityColor(deity) {
        const deityColors = {
            'Siva': '#ff6b6b',
            'Ganesh': '#4ecdc4',
            'Hanuman': '#45b7d1',
            'Devi': '#96ceb4',
            'Siva-Parvati': '#feca57',
            'Rama family': '#ff9ff3',
            'Rama-Sita': '#ff9ff3',
            'Sitla Maa': '#54a0ff',
            '__ Bir Baabaa': '#5f27cd',
            'Other': '#c8d6e5'
        };
        
        // Check for primary deity first
        for (const [key, color] of Object.entries(deityColors)) {
            if (deity && deity.includes(key)) {
                return color;
            }
        }
        return '#95a5a6'; // Default gray
    }

    function getColorByCount(count) {
        if (count === 0) return '#f8f9fa';
        if (count <= 5) return '#d4edda';
        if (count <= 10) return '#fff3cd';
        if (count <= 20) return '#f8d7da';
        return '#721c24';
    }

    function addLegend() {
        if (window.legend) {
            map.removeControl(window.legend);
        }
        
        window.legend = L.control({position: 'bottomright'});
        window.legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'info legend');
            const currentLayer = window.currentLayer || 'density';
            
            if (currentLayer === 'density') {
                div.innerHTML = `
                    <h4>Mandir Density</h4>
                    <i style="background: #d4edda"></i> 1-5 mandirs<br>
                    <i style="background: #fff3cd"></i> 6-10 mandirs<br>
                    <i style="background: #f8d7da"></i> 11-20 mandirs<br>
                    <i style="background: #721c24"></i> 20+ mandirs<br>
                `;
            } else {
                div.innerHTML = `
                    <h4>Deity Types</h4>
                    <i style="background: #ff6b6b"></i> Siva<br>
                    <i style="background: #4ecdc4"></i> Ganesh<br>
                    <i style="background: #45b7d1"></i> Hanuman<br>
                    <i style="background: #96ceb4"></i> Devi<br>
                    <i style="background: #feca57"></i> Siva-Parvati<br>
                    <i style="background: #ff9ff3"></i> Rama Family<br>
                    <i style="background: #5f27cd"></i> Bir Baabaa<br>
                `;
            }
            return div;
        };
        window.legend.addTo(map);
    }

    function updateStatistics() {
        // Only update if data is available
        if (mandirData && mandirData.length > 0 && hexData && hexData.length > 0) {
            const totalMandirs = mandirData.length;
            const maxDensity = Math.max(...hexData.map(h => h.properties.deity_count || 0));
            const avgDensity = hexData.reduce((sum, h) => sum + (h.properties.deity_count || 0), 0) / hexData.length;
            
            // Calculate coverage area (approximate)
            const bounds = map.getBounds();
            const coverageArea = ((bounds.getNorth() - bounds.getSouth()) * (bounds.getEast() - bounds.getWest()) * 111 * 111).toFixed(1);
            
            $('#total-mandirs').text(totalMandirs.toLocaleString());
            $('#max-density').text(maxDensity);
            $('#avg-density').text(avgDensity.toFixed(1));
            $('#coverage-area').text(coverageArea);
        } else {
            // Show loading state
            $('#total-mandirs').text('Loading...');
            $('#max-density').text('Loading...');
            $('#avg-density').text('Loading...');
            $('#coverage-area').text('Loading...');
        }
    }

    function initializeCharts() {
        // Density distribution chart
        const densityCtx = document.getElementById('densityChart').getContext('2d');
        window.densityChart = new Chart(densityCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Number of Hexagons',
                    data: [],
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Hexagons'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Mandir Count Range'
                        }
                    }
                }
            }
        });

        // Deity distribution chart
        const deityCtx = document.getElementById('deityChart').getContext('2d');
        window.deityChart = new Chart(deityCtx, {
            type: 'doughnut',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: [
                        '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', 
                        '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd', '#c8d6e5'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Structure distribution chart
        const structureCtx = document.getElementById('structureChart').getContext('2d');
        window.structureChart = new Chart(structureCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Number of Mandirs',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Mandirs'
                        }
                    }
                }
            }
        });
    }

    function updateDensityChart() {
        const densityRanges = {
            '0': 0, '1-5': 0, '6-10': 0, '11-15': 0, '16-20': 0, '20+': 0
        };
        
        hexData.forEach(hex => {
            const count = hex.properties.deity_count || 0;
            if (count === 0) densityRanges['0']++;
            else if (count <= 5) densityRanges['1-5']++;
            else if (count <= 10) densityRanges['6-10']++;
            else if (count <= 15) densityRanges['11-15']++;
            else if (count <= 20) densityRanges['16-20']++;
            else densityRanges['20+']++;
        });
        
        window.densityChart.data.labels = Object.keys(densityRanges);
        window.densityChart.data.datasets[0].data = Object.values(densityRanges);
        window.densityChart.update();
    }

    function updateDeityChart() {
        const deityCounts = {};
        
        mandirData.forEach(mandir => {
            const deities = mandir.properties.deity || 'Unknown';
            const deityList = deities.split(',').map(d => d.trim());
            
            deityList.forEach(deity => {
                deityCounts[deity] = (deityCounts[deity] || 0) + 1;
            });
        });
        
        // Sort by count and take top 8
        const sortedDeities = Object.entries(deityCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 8);
        
        window.deityChart.data.labels = sortedDeities.map(([deity]) => deity);
        window.deityChart.data.datasets[0].data = sortedDeities.map(([,count]) => count);
        window.deityChart.update();
    }

    function updateStructureChart() {
        const structureCounts = {};
        
        mandirData.forEach(mandir => {
            const structure = mandir.properties.temple_str || 'Unknown';
            const structureList = structure.split(',').map(s => s.trim());
            
            structureList.forEach(str => {
                structureCounts[str] = (structureCounts[str] || 0) + 1;
            });
        });
        
        // Sort by count
        const sortedStructures = Object.entries(structureCounts)
            .sort(([,a], [,b]) => b - a);
        
        window.structureChart.data.labels = sortedStructures.map(([structure]) => structure);
        window.structureChart.data.datasets[0].data = sortedStructures.map(([,count]) => count);
        window.structureChart.update();
    }

    function switchLayer(layerType) {
        window.currentLayer = layerType;
        
        // Update button states
        $('.control-btn').removeClass('active');
        $(`.control-btn[onclick="switchLayer('${layerType}')"]`).addClass('active');
        
        if (layerType === 'density') {
            displayHexData();
        } else if (layerType === 'individual') {
            displayMandirData();
        }
        
        addLegend();
    }

    function resetView() {
        map.setView([25.3176, 82.9739], 13);
    }

    function toggleArticle() {
        const articleSection = document.getElementById('articleSection');
        const button = document.querySelector('.article-toggle');
        
        if (articleSection.classList.contains('expanded')) {
            articleSection.classList.remove('expanded');
            button.innerHTML = '📖 Read About the Mandirs of Varanasi';
        } else {
            articleSection.classList.add('expanded');
            button.innerHTML = '📖 Hide Article';
        }
    }
  </script>

</body>

</html>